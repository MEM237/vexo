<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEXO Video Text (VTX)</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <style>
        #localVideo, #remoteVideoContainer {
            width: 300px;
            height: 200px;
            margin: 5px;
            background-color: black;
        }
        #remoteVideoContainer {
            position: relative;
        }
        #placeholderImage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #remoteVideo {
            display: none;
        }
    </style>
</head>
<body>
    <h1>VEXO Video Text (VTX) System</h1>
    <video id="localVideo" autoplay playsinline></video>

    <!-- Remote video container with placeholder image -->
    <div id="remoteVideoContainer">
        <img id="placeholderImage" src="placeholder1.jpg" alt="Remote placeholder">
        <video id="remoteVideo" autoplay playsinline></video>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "vexo-8df2d.firebaseapp.com",
            databaseURL: "https://vexo-8df2d-default-rtdb.firebaseio.com",
            projectId: "vexo-8df2d",
            storageBucket: "vexo-8df2d.appspot.com",
            messagingSenderId: "54849424101",
            appId: "1:54849424101:web:604c71656e7ce3dbdd220c",
            measurementId: "G-T0FVZNZCB4"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Placeholder images array
        const placeholderImages = [
            "placeholder1.jpg",
            "placeholder2.jpg",
            "placeholder3.jpg",
            "placeholder4.jpg",
            "placeholder5.jpg"
        ];

        // Select a random placeholder image
        const randomImage = placeholderImages[Math.floor(Math.random() * placeholderImages.length)];
        document.getElementById("placeholderImage").src = randomImage;

        // WebRTC configuration
        const configuration = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };
        const peerConnection = new RTCPeerConnection(configuration);

        // Video elements
        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');
        const placeholderImage = document.getElementById('placeholderImage');

        // Access local camera
        navigator.mediaDevices.getUserMedia({ video: true, audio: false })
            .then(stream => {
                localVideo.srcObject = stream;
                stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));
            })
            .catch(error => console.error("Error accessing camera:", error));

        // Handle ICE candidates
        peerConnection.onicecandidate = event => {
            if (event.candidate) {
                const candidate = event.candidate.toJSON();
                database.ref('signaling/candidates').push(candidate);
            }
        };

        // Display remote video and hide placeholder when a remote stream is available
        peerConnection.ontrack = event => {
            placeholderImage.style.display = "none";
            remoteVideo.style.display = "block";
            remoteVideo.srcObject = event.streams[0];
        };

        // Signaling: offer/answer exchange
        function createOffer() {
            peerConnection.createOffer().then(offer => {
                peerConnection.setLocalDescription(offer);
                database.ref('signaling/offer').set(offer);
            });
        }

        function createAnswer() {
            peerConnection.createAnswer().then(answer => {
                peerConnection.setLocalDescription(answer);
                database.ref('signaling/answer').set(answer);
            });
        }

        // Firebase listeners for offer/answer
        database.ref('signaling/offer').on('value', snapshot => {
            if (!snapshot.exists()) return;
            const offer = snapshot.val();
            peerConnection.setRemoteDescription(new RTCSessionDescription(offer));
            createAnswer();
        });

        database.ref('signaling/answer').on('value', snapshot => {
            if (!snapshot.exists()) return;
            const answer = snapshot.val();
            peerConnection.setRemoteDescription(new RTCSessionDescription(answer));
        });

        // Handle incoming ICE candidates
        database.ref('signaling/candidates').on('child_added', snapshot => {
            const candidate = new RTCIceCandidate(snapshot.val());
            peerConnection.addIceCandidate(candidate);
        });

        // Start the offer process
        createOffer();
    </script>
</body>
</html>

